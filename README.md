# CONTACTS
## contacts - api проект приложения для знакомств
### Авторы:
- Ilya Rogozin https://github.com/ilyarogozin
### Технологии
- Python
- Django
- DRF
- Библиотеки: djangorestframework-simplejwt, Pillow, django-imagekit, geopy, django-filter

### Комментарий для тестирования:
Почта настроена для dev-режима(письма отправляются во внутреннюю папку __sent_emails__ проекта),
вы легко сможете протестировать его через браузер(аватарку отправлять не обязательно, устанавливается дефолтная, если ничего не отправили в поле __avatar__), лично я тестировал через Postman(если нужно с аватаркой протестировать водяной знак), я написал подробный гайд развёртывания проекта локально.
Пользователь вводит страну и город на основании которых вычисляются координаты города через библиотеку geopy,
потом эти координаты сохраняются в объекте модели User, через неё же(geopy) вычисляю расстояние между городами(great_circle).

### Запуск проекта в dev-режиме:
- Клонируйте репозиторий(по ssh):
```
git clone git@github.com:ilyarogozin/contacts.git
```

- Перейдите в папку проекта:
```
cd contacts/
```

- Создайте и запустите окружение:
```
python3 -m venv venv && source venv/bin/activate
```

- Установите SECRET_KEY в виртуальное окружение(можно установить любой свой ключ):
```
export SECRET_KEY='django-insecure-h8oyawss)_kb!sa=t09r2=_ljt$yw_w6-by=lp(mkc&b=w%(sg'
```

- Обновите пакетный менеджер и установите зависимости:
```
python3 -m pip install --upgrade pip && pip3 install -r requirements.txt
```

- В папке с файлом manage.py выполните команду:
```
python3 manage.py runserver
```

### Примеры API запросов:
#### Запросы доступные для анонимов(создание пользователя и получение токена авторизации):
#### POST запрос на:
```
http://127.0.0.1:8000/api/clients/create/
```
- После отправки запроса, на почту(в папку __sent_emails__) придёт письмо с кодом подтверждения
- Пример тела запроса:
```
{
    "username": "Обязательное поле. type string",
    "avatar": "Необязательное поле. type Image",
    "gender": "Обязательное поле. choice male or female",
    "first_name": "Обязательное поле. type string",
    "last_name": "Обязательное поле. type string",
    "email": "Обязательное поле. type string",
    "country": "Необязательно поле. type string, default='Russia'",
    "city": "Необязательное поле. type string, default='Moscow'"
}
```

#### Далее POST запрос для подтверждения почты и получения токена авторизации на:
```
http://127.0.0.1:8000/api/auth/token/
```
- Тело запроса:
```
{
    "username": "Обязательное поле. type string",
    "confirmation_code": "Обязательное поле. type string, код из почты"
}
```
- Ответ:
```
{
    "token": "string"
}
```

#### Следующие запросы выполняются с токеном авторизации в header'е Authorization
#### GET запрос на:
```
http://127.0.0.1:8000/api/clients/{id}/match/
```
- Если у вас взаимный лайк с пользователем, то придёт ответ и отправятся письма на почту обоим:
```
{
    "Email вашего совпадения": "email, type string"
}
```
- Иначе просто придёт ответ 200
#### GET запрос посмотреть всех пользователей:
```
http://127.0.0.1:8000/api/list/
```
#### GET запрос с фильтрацией пользователей по полу/имени/фамилии(фильтрация выполняется по полному! совпадению и чувствительна! к регистру):
```
http://127.0.0.1:8000/api/list/?gender=male&first_name=ilya&last_name=rogozin
```
#### GET запрос с фильтрацией по диапазону(range) относительно пользователя в километрах:
```
http://127.0.0.1:8000/api/list/?range=200
```